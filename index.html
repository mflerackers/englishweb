<html>
<header>
    <link href="https://fonts.googleapis.com/css?family=Kalam" rel="stylesheet">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-109740765-2"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        
        gtag('config', 'UA-109740765-2');
    </script>
    <style>
        body {
            width: 100%
        }
        div.word {
            display: inline-block;
            font-family: 'Kalam', cursive;
            font-size: 20vw;
        }
        div.container {
            text-align: center;
            width: 100%
        }
        div.word span {
            -webkit-text-stroke: 1.5px black;
        }
        #error {
            font-family: "Lato", "Lucida Grande", "Lucida Sans Unicode", "Tahoma", "Sans-Serif";
        }
    </style>
    <link rel="stylesheet" type="text/css" href="./colors.css/">
    <script src="./rita-full.min.js"/></script>
    <script src="./color-phonemes.js"/></script>
</header>
<body>
    <a href="./phoneme-quiz.html">Phoneme quiz</a>
    <center><input id="word" type="text" placeholder="Type here"></center>
    <div class="container">
        <div class="word" id="worddisplay"></div>
    </div>
    <center><span id="error" style="color:red"></span></center>
</body>
<script>
    function getClasses(match) {
        if ((match.ph == "S" && match.ch == "c") ||
        (match.ph == "V" && match.ch == "f") ||
        (match.ph == "T" && match.ch == "d") ||
        (match.ph == "Z" && match.ch == "s")) {
            return "weird";
        }
        else {
            return match.ph;
        }
    }
    
    function refreshText(input) {
        let text = input.value.toLowerCase();
        
        document.getElementById("worddisplay").innerHTML = "";
        document.getElementById("error").innerText = "";
        
        if (text.length == 0) {
            return;
        }

        let re = /([a-z]+)|([^a-z]+)/g;
        let m;
        let html = "";
        while (m = re.exec(text)) {
            let word = m[0];

            if (m[1]) {
                let phonemes = RiTa.getPhonemes(word).toUpperCase().split("-");
                phonemes = transformPhonemes(phonemes);
                
                console.log(phonemes);
                
                let result = null;
                try {
                    result = matchPhonemes(word, phonemes);
                }
                catch (message) {
                    document.getElementById("error").innerText = message;
                    return;
                }
                
                console.log(result);
                
                
                for (matches of result) {
                    for (c of [...matches.ch]) {
                        html += "<span class='" + getClasses(matches) + "'>" + c + "</span>";
                    }
                }
            }
            else {
                html += word;
            }
        }
        
        document.getElementById("worddisplay").innerHTML = html;
    }
    
    document.getElementById("word").oninput = function() {
        refreshText(this);
    }
    
    refreshText(document.getElementById("word"));
</script>
</html>
